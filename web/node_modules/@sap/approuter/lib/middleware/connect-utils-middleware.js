'use strict';

const connectUtils = require('../connect/utils');
const urlUtils = require('./../utils/url-utils');

module.exports = function (app) {
  return function connectUtilsMiddleWare(req, res, next) {
    connectUtils.setPropertiesToRequest(req, app);
    let err = connectUtils.validateHeaders(req);
    if (err !== null) {
      err.status = 400;
      return next(err);
    }
    if ((process.env.DISABLE_PATHNAME_VALIDATION || '').toLowerCase() !== 'true') {
      err = urlUtils.validatePathname(req);
      if (err !== null) {
        err.status = 400;
        return next(err);
      }
    }
    next();
  };
};
