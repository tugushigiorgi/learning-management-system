'use strict';

const NodeCache = require('node-cache');

const stdTTL              = parseInt(process.env.STATE_CACHE) || 180;
const CHECK_PERIOD         = stdTTL + 20;
const STATE_CACHE          = new NodeCache({stdTTL: stdTTL, checkperiod: CHECK_PERIOD});

function setCacheStateValue(state) {
  STATE_CACHE.set(state, state);
}

function getCacheStateValue(state) {
  return STATE_CACHE.get(state);
}

function isActiveStateCookie(cookie) {
  try {
    const cookieValue = cookie.trim().split('=')[1];
    return STATE_CACHE.has(cookieValue);
  } catch (_) {
    return false;
  }
}

module.exports = {
  setCacheStateValue,
  getCacheStateValue,
  isActiveStateCookie
};
